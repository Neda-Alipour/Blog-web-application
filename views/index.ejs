<%- include("partials/header.ejs") %>

<% if (msg) { %>
  <div id="alertBox" class="alert alert-success alert-dismissible fade show text-center fw-semibold shadow-sm" role="alert">
    <%= msg %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<h2 class="mb-4 fw-bold text-center gradient-text">All Posts</h2>

<div class="d-flex flex-column gap-4">
  <% if (posts.length === 0) { %>
    <p class="text-muted text-center">No posts yet. <a href="/new-post" class="text-decoration-none fw-semibold text-primary">Create one</a></p>
  <% } %>
  <% posts.forEach(post => { %>
    <div class="card post-card shadow-sm border-0 p-4">
      <h4 class="fw-bold mb-1"><%= post.title %></h4>
      <p class="text-secondary small mb-3">
        ðŸ•“ Posted on <%= new Date(post.createdTime).toLocaleString('en-US', { dateStyle: 'medium', timeStyle: 'short' }) %>
      </p>
      <p><%= post.content %></p>
      <div class="d-flex gap-2 mt-3">
        <a href="/edit/<%= post.id %>" class="btn btn-sm btn-outline-primary">Edit</a>
        <form action="/delete/<%= post.id %>" method="POST" class="d-inline">
          <button class="btn btn-sm btn-outline-danger">Delete</button>
        </form>
      </div>
    </div>
  <% }) %>
</div>

<%- include("partials/footer.ejs") %>

<script>
    setTimeout(() => {
    const alert = document.getElementById('alertBox');
    if (alert) {
        alert.classList.remove('show');
        alert.classList.add('fade');
        setTimeout(() => alert.remove(), 500);
    }
    }, 3000);

    const url = new URL(window.location);
    if (url.searchParams.has('msg')) {
      url.searchParams.delete('msg');
      window.history.replaceState({}, document.title, url.pathname);
    }
</script>
